$(document).on('click', '[data-toggle^="class"]', function(e){
  e && e.preventDefault();
  var $this = $(e.target), $class , $target, $tmp, $classes, $targets;
  !$this.data('toggle') && ($this = $this.closest('[data-toggle^="class"]'));
  $class = $this.data()['toggle'];
  $target = $this.data('target') || $this.attr('href');
  $class && ($tmp = $class.split(':')[1]) && ($classes = $tmp.split(','));
  $target && ($targets = $target.split(','));
  $classes && $classes.length && $.each($targets, function( index, value ) {
    if ( $classes[index].indexOf( '*' ) !== -1 ) {
      var patt = new RegExp( '\\s' +
          $classes[index].
            replace( /\*/g, '[A-Za-z0-9-_]+' ).
            split( ' ' ).
            join( '\\s|\\s' ) +
          '\\s', 'g' );
      $($this).each( function ( i, it ) {
        var cn = ' ' + it.className + ' ';
        while ( patt.test( cn ) ) {
          cn = cn.replace( patt, ' ' );
        }
        it.className = $.trim( cn );
      });
    }
    ($targets[index] !='#') && $($targets[index]).toggleClass($classes[index]) || $this.toggleClass($classes[index]);
  });
  $this.toggleClass('active');
});

$('#bjax-target').slimScroll({
  height:'auto'
});
$(document).ready(function() {
  var musiclist = [{
        title:"追光者",
        artist:"岑宁儿",
        mp3:"http://www.jplayer.org/audio/mp3/TSP-01-Cro_magnon_man.mp3",
        image:"p10.jpg"
      },
      {
  			title:"Your Face",
        artist:"岑宁儿",
  			mp3:"http://www.jplayer.org/audio/mp3/TSP-05-Your_face.mp3",
        image:"p1.jpg"
  		},
  		{
  			title:"Cyber Sonnet",
        artist:"岑宁儿",
  			mp3:"http://www.jplayer.org/audio/mp3/TSP-07-Cybersonnet.mp3",
        image:"p2.jpg"
  		},
  		{
  			title:"Tempered Song",
        artist:"岑宁儿",
  			mp3:"http://www.jplayer.org/audio/mp3/Miaow-01-Tempered-song.mp3",
        image:"p3.jpg"
  		},
  		{
  			title:"Hidden",
        artist:"岑宁儿",
  			mp3:"http://www.jplayer.org/audio/mp3/Miaow-02-Hidden.mp3",
        image:"p4.jpg"
  		},
  		{
  			title:"Lentement",
        artist:"岑宁儿",
  			mp3:"http://www.jplayer.org/audio/mp3/Miaow-03-Lentement.mp3",
        image:"p5.jpg"
  		},
  		{
  			title:"Lismore",
        artist:"岑宁儿",
  			mp3:"http://www.jplayer.org/audio/mp3/Miaow-04-Lismore.mp3",
        image:"p6.jpg"
  		},
  		{
  			title:"The Separation",
        artist:"岑宁儿",
  			mp3:"http://www.jplayer.org/audio/mp3/Miaow-05-The-separation.mp3",
  			image:"p7.jpg"
  		},
  		{
  			title:"Beside Me",
        artist:"岑宁儿",
  			mp3:"http://www.jplayer.org/audio/mp3/Miaow-06-Beside-me.mp3",
  			image:"p8.jpg"
  		},
  		{
  			title:"Bubble",
        artist:"岑宁儿",
  			mp3:"http://www.jplayer.org/audio/mp3/Miaow-07-Bubble.mp3",
  			image:"p9.jpg"
  		},];
    const requireContext = require.context("../src/public-resource/imgs",true, /^\.\/.*\.jpg$/);
    const projectImgs = requireContext.keys().map(requireContext);
    var imgURL = [];
    for (var j = 0; j < projectImgs.length;j++){

            imgURL.push(projectImgs[j]);
    }
    console.log(imgURL)
  var myPlaylist = new jPlayerPlaylist({
    jPlayer: "#jplayer_N",
    cssSelectorAncestor: "#jp_container_N"
  },
      musiclist
  , {
    playlistOptions: {
      enableRemoveControls: true,
      autoPlay: true
    },
    swfPath: "./jPlayer",
    supplied: "webmv, ogv, m4v, oga, mp3",
    smoothPlayBar: true,
    keyEnabled: true,
    audioFullScreen: false
  })
  var opt = "";
  for(var i = 0;i < musiclist.length;i++){
    opt += '<div class="col-xs-6 col-sm-3 col-md-4 col-lg-2" style="margin-right:40px;">'+
    '<div class="item">'+
        '<div class="pos-rlt">'+
            '<div class="item-overlay opacity r r-2x bg-black">'+
                '<div class="text-info padder m-t-sm text-sm">'+
                '<i class="fa fa-star"></i>'+
                '<i class="fa fa-star"></i>'+
                '<i class="fa fa-star"></i>'+
                '<i class="fa fa-star-o text-muted"></i>'+
                '<i class="fa fa-star-o text-muted"></i>'+
                '</div>'+
                    '<div class="center text-center m-t-n">'+
                    '<a href="#" data-toggle="class" class="jp-play">'+
                    '<i class="icon-control-play i-2x text"></i>'+
                    '<i class="icon-control-pause i-2x text-active"></i>'+
                    '</a>'+
                    '</div>'+
                        '<div class="bottom padder m-b-sm">'+
                        '<a href="#" class="pull-right active" data-toggle="class">'+
                          '<i class="fa fa-heart-o text"></i>'+
                          '<i class="fa fa-heart text-active text-danger"></i>'+
                        '</a>'+
                        '<a href="#" data-toggle="class">'+
                          '<i class="fa fa-plus-circle text"></i>'+
                          '<i class="fa fa-check-circle text-active text-info"></i>'+
                        '</a>'+
                        '</div>'+
            '</div>'+
            '<a href="#"><img src="'+imgURL[i+2]+'" style="width:100%;height:100%"/></a>'+
        // '<a href="#"><img src="${require('+"'../../../public-resource/imgs/p.jpg"+"')}" '" alt="" class="r r-2x img-full"></a>'+
        // '<a href="#"><img src="<%= require('+"'../../../imgs/"+musiclist[i].image+'" alt="" class="r r-2x img-full"></a>'+
        '</div>'+
        '<div class="padder-v">'+
        '<a href="#" class="text-ellipsis">'+musiclist[i].title+'</a>'+
        '<a href="#" class="text-ellipsis text-xs text-muted">'+musiclist[i].artist+'</a>'+
        '</div>'+
    '</div>'+
    '</div>';
  }
$('#menulist').html(opt);
$(document).on('click','.jp-play',function(e){
  var which_play = 0;
  e && e.preventDefault();
  var $this = $(e.target);
  if(!$this.is('a')) $this = $this.closest('a');
  $('.jp-play').not($this).removeClass('active');
  $this.parent().parent().parent().parent('.item').toggleClass('active');
  if($(this).hasClass('active')){
    var musicName = $this.parent().parent().parent().parent('.item').children('.padder-v').children('a').html();
    for(var i = 0;i < musiclist.length;i++){
      var obj = musiclist[i];
      for(var title in obj){
        if(obj['title'] === musicName)which_play = i;
      }
    }
    myPlaylist.play(which_play);
  }
})

$(document).on($.jPlayer.event.pause, myPlaylist.cssSelector.jPlayer,  function(){
  $('.musicbar').removeClass('animate');
  $('.jp-play-me').removeClass('active');
  $('.jp-play-me').parent('li').removeClass('active');
});

$(document).on($.jPlayer.event.play, myPlaylist.cssSelector.jPlayer,  function(){
  $('.musicbar').addClass('animate');
});

$(document).on('click', '.jp-play-me', function(e){
  e && e.preventDefault();
  var $this = $(e.target);
  if (!$this.is('a')) $this = $this.closest('a');

  $('.jp-play-me').not($this).removeClass('active');
  $('.jp-play-me').parent('li').not($this.parent('li')).removeClass('active');

  $this.toggleClass('active');
  $this.parent('li').toggleClass('active');
  if( !$this.hasClass('active') ){
    myPlaylist.pause();
  }else{
    var i = Math.floor(Math.random() * (1 + 7 - 1));
    myPlaylist.play(i);
  }
});
})
